<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>谢孟雄的主页</title>
  <style>
    *{
      padding:0;
      margin:0;
      overflow-y: hidden;
    }
  </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
      window.requestAnimationFrame = function() {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(a) {
          window.setTimeout(a, 1E3 / 60)
        }
      }()
      var canvas = document.getElementById('canvas')
      canvas.width = window.innerWidth
      canvas.height = window.innerHeight
      var width = canvas.width
      var height = canvas.height
      var max = 100
      var ctx = canvas.getContext('2d')
      ctx.fillRect(20,20,100,100)
      var dots = []
      for (var i = 0; i < 200; i++) {
        var x = Math.random() * width
        var y = Math.random() * height
        var xa = (Math.random() * 3 - 1) / 1.5
        var ya = (Math.random() * 3 - 1) / 1.5
        dots.push({x,y,xa,ya})
      }
      var marea = {x:null,y:null}
      canvas.addEventListener('mousemove', function (e) {
        marea.x = e.clientX
        marea.y = e.clientY
      })
      canvas.addEventListener('mouseout',function(e){
        marea.x = null
        marea.y = null
      })
      var ndots = dots.concat(marea)
      function draw () {
        ctx.clearRect(0,0,width,height)
        dots.forEach((dot,index) =>{
          dot.x += dot.xa
          dot.y += dot.ya
          dot.xa *= (dot.x > width || dot.x < 0) ? -1 :1
          dot.ya *= (dot.y > height || dot.y < 0) ? -1 :1
          ctx.fillRect(dot.x -0.5 , dot.y - 0.5,1,1)
          for (var i = 0; i < ndots.length; i++) {
            var ndot = ndots[i]
            if (ndot === dot || ndot.x === null || ndot.y ===null ) {continue}
            var xc = Math.abs(dot.x - ndot.x)
            var yc = Math.abs(dot.y - ndot.y)
            if (xc > max || yc > max ) {continue}
            var dis =Math.sqrt(xc * xc + yc * yc)
            if (dis > max ) {continue}
            if(ndot === marea) {
              dot.x -= (dot.x - ndot.x) * 0.01
              dot.y -= (dot.y - ndot.y) * 0.01
            }
            var ratio = (max - dis)/max
            ctx.beginPath()
            ctx.lineWidth = ratio / 2
            ctx.moveTo(dot.x,dot.y)
            ctx.lineTo(ndot.x,ndot.y)
            ctx.stroke()
          }
        })
        window.requestAnimationFrame(draw)
      }
      window.requestAnimationFrame(draw)
    </script>
</body>
</html>
